@using System
@using System.Collections.Generic
@model PerfumeStore.Areas.Admin.Models.IPagedResult

@functions {
    string BuildUrl(int page)
    {
        var query = Context.Request.QueryString.Value;
        if (string.IsNullOrEmpty(query))
        {
            return $"?page={page}";
        }
        
        // Remove existing page parameter
        var queryParams = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(query);
        var newParams = new Dictionary<string, Microsoft.Extensions.Primitives.StringValues>();
        
        foreach (var kvp in queryParams)
        {
            if (!string.Equals(kvp.Key, "page", StringComparison.OrdinalIgnoreCase))
            {
                newParams[kvp.Key] = kvp.Value;
            }
        }
        
        // Add new page parameter
        newParams["page"] = page.ToString();
        
        return Microsoft.AspNetCore.WebUtilities.QueryHelpers.AddQueryString("", newParams);
    }
}

@if (Model != null && Model.TotalPages > 1)
{

    <nav aria-label="Pagination">
        <ul class="pagination justify-content-center mt-3">
            <li class="page-item @(Model.HasPreviousPage ? string.Empty : "disabled")">
                @if (Model.HasPreviousPage)
                {
                    <a class="page-link" href="@BuildUrl(Model.CurrentPage - 1)" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                }
                else
                {
                    <span class="page-link">
                        <span aria-hidden="true">&laquo;</span>
                    </span>
                }
            </li>

            @for (var pageNumber = Model.StartPage; pageNumber <= Model.EndPage; pageNumber++)
            {
                <li class="page-item @(pageNumber == Model.CurrentPage ? "active" : string.Empty)">
                    <a class="page-link" href="@BuildUrl(pageNumber)">@pageNumber</a>
                </li>
            }

            <li class="page-item @(Model.HasNextPage ? string.Empty : "disabled")">
                @if (Model.HasNextPage)
                {
                    <a class="page-link" href="@BuildUrl(Model.CurrentPage + 1)" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                }
                else
                {
                    <span class="page-link">
                        <span aria-hidden="true">&raquo;</span>
                    </span>
                }
            </li>
        </ul>
    </nav>
}

