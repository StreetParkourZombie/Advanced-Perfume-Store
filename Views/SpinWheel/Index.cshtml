@model PerfumeStore.Models.ViewModels.SpinWheelViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "V√≤ng Quay Voucher";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="spinwheel-page" style="background: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)), url('@Url.Content("~/images/Checkout/background2.jpg")'); background-size: cover; background-position: center; background-attachment: fixed;">
    <!-- Background Effects -->
    <div class="spinwheel-bg">
        <div class="floating-particles"></div>
        <div class="gradient-overlay"></div>
    </div>

    <div class="container-fluid">
        <div class="row justify-content-center min-vh-100 align-items-center">
            <div class="col-12 col-xl-10">
                <div class="spinwheel-container">
                    <!-- Header Section -->
                    <div class="spinwheel-header text-center mb-5">
                        <div class="header-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <h1 class="spinwheel-title">
                            <span class="title-main">V√≤ng Quay Voucher</span>
                            <span class="title-sub">Quay v√≤ng ƒë·ªÉ nh·∫≠n voucher gi·∫£m gi√° h·∫•p d·∫´n!</span>
                        </h1>
                        <div class="header-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="remainingSpins">@Model.RemainingSpins</span>
                                <span class="stat-label">L∆∞·ª£t quay c√≤n l·∫°i</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="availableCouponCount">@Model.AvailableVouchers.Count</span>
                                <span class="stat-label">Coupon c√≤n l·∫°i</span>
                            </div>
                        </div>
                    </div>

                    <!-- Main Wheel Section -->
                    <div class="wheel-section">
                        @if (!Model.HasCoupons)
                        {
                            <div class="alert alert-info text-center mb-4" id="noCouponMessage">
                                Kh√¥ng c√≥ coupon n√†o tr√™n v√≤ng quay ·ªü th·ªùi ƒëi·ªÉm hi·ªán t·∫°i. Vui l√≤ng quay l·∫°i sau!
                            </div>
                        }

                        <div class="wheel-container">
                            <!-- Wheel Background -->
                            <div class="wheel-bg">
                                <div class="wheel-ring outer-ring"></div>
                                <div class="wheel-ring middle-ring"></div>
                                <div class="wheel-ring inner-ring"></div>
                            </div>

                            <!-- Spin Wheel -->
                            <div class="spin-wheel" id="spinWheel">
                                <!-- Sectors will be generated by JavaScript -->
                            </div>

                            <!-- Center Circle - N√∫t quay -->
                            <div class="wheel-center" id="spinBtn">
                                <i class="fas fa-play center-logo"></i>
                                <div class="center-text">QUAY NGAY</div>
                            </div>

                            <!-- Pointer -->
                            <div class="wheel-pointer">
                                <div class="pointer-triangle"></div>
                                <div class="pointer-shadow"></div>
                            </div>

                            <!-- Sparkle Effects -->
                            <div class="sparkles">
                                <div class="sparkle sparkle-1"></div>
                                <div class="sparkle sparkle-2"></div>
                                <div class="sparkle sparkle-3"></div>
                                <div class="sparkle sparkle-4"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="instructions-section mt-5">
                        <h3 class="text-center mb-4" style="color: #d9534f;">H∆∞·ªõng d·∫´n ch∆°i</h3>
                        <div class="instructions-grid">
                            <div class="instruction-card">
                                <div class="card-icon"><i class="fas fa-hand-pointer"></i></div>
                                <h5 class="card-title">B∆∞·ªõc 1</h5>
                                <p class="card-text">Nh·∫•n n√∫t "QUAY NGAY" ƒë·ªÉ b·∫Øt ƒë·∫ßu v√≤ng quay.</p>
                            </div>
                            <div class="instruction-card">
                                <div class="card-icon"><i class="fas fa-hourglass-half"></i></div>
                                <h5 class="card-title">B∆∞·ªõc 2</h5>
                                <p class="card-text">Ch·ªù v√≤ng quay d·ª´ng v√† xem k·∫øt qu·∫£.</p>
                            </div>
                            <div class="instruction-card">
                                <div class="card-icon"><i class="fas fa-gift"></i></div>
                                <h5 class="card-title">B∆∞·ªõc 3</h5>
                                <p class="card-text">Nh·∫≠n voucher v√† √°p d·ª•ng khi thanh to√°n.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Voucher List Section -->
                    <div class="voucher-list-section mt-5">
                        <h3 class="text-center mb-4" style="color: #d9534f;">üéÅ C√°c voucher c√≥ th·ªÉ tr√∫ng</h3>
                        @if (Model.HasCoupons)
                        {
                            <div class="voucher-list" id="voucherList">
                                <!-- Voucher cards will be generated by JavaScript -->
                            </div>
                        }
                        else
                        {
                            <p class="text-center text-muted" id="voucherList">
                                Kh√¥ng c√≥ coupon tr√™n v√≤ng quay.
                            </p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Result Modal - Outside all containers for full screen display -->
<div class="result-modal" id="resultModal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">üéâ K·∫øt qu·∫£ quay th∆∞·ªüng</h5>
            <button type="button" class="btn-close" id="closeModal" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body text-center">
            <div id="resultContent"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="closeModalBtn">ƒê√≥ng</button>
            <button type="button" class="btn btn-info" id="saveVoucherBtn" style="display: none;">
                <i class="fas fa-save me-2"></i>L∆∞u voucher
            </button>
            <button type="button" class="btn btn-success" id="applyVoucherBtn" style="display: none;">
                <i class="fas fa-check-circle me-2"></i>√Åp d·ª•ng voucher
            </button>
        </div>
    </div>
</div>

@{
    var serializerOptions = new JsonSerializerOptions
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    };
    var vouchersJson = JsonSerializer.Serialize(Model.AvailableVouchers, serializerOptions);
}

<script>
    window.spinWheelData = {
        vouchers: @Html.Raw(vouchersJson),
        hasCoupons: @Model.HasCoupons.ToString().ToLower(),
        remainingSpins: @Model.RemainingSpins,
        dailySpins: @Model.DailySpins,
        couponCount: @Model.AvailableVouchers.Count
    };
</script>
<script src="~/js/SpinWheel.js" asp-append-version="true"></script>