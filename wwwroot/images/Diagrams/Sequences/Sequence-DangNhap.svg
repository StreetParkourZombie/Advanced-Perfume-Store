<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .actor { fill: #E8F4F8; stroke: #2E5C8A; stroke-width: 2; }
      .lifeline { stroke: #666; stroke-width: 1; stroke-dasharray: 5,5; }
      .message { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .self-message { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .activation { fill: #4A90E2; opacity: 0.3; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .text-small { font-family: Arial, sans-serif; font-size: 10px; }
      .text-bold { font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; }
      .alt-box { fill: #FFF9E6; stroke: #D68910; stroke-width: 2; stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle">Sequence Diagram: Đăng Nhập</text>
  
  <!-- Actors -->
  <rect x="50" y="60" width="120" height="60" class="actor" rx="5"/>
  <text x="110" y="85" class="text-bold" text-anchor="middle">Người dùng</text>
  <text x="110" y="100" class="text-small" text-anchor="middle">(User)</text>
  
  <rect x="250" y="60" width="120" height="60" class="actor" rx="5"/>
  <text x="310" y="85" class="text-bold" text-anchor="middle">Web Application</text>
  <text x="310" y="100" class="text-small" text-anchor="middle">(AuthController)</text>
  
  <rect x="450" y="60" width="120" height="60" class="actor" rx="5"/>
  <text x="510" y="85" class="text-bold" text-anchor="middle">Database</text>
  <text x="510" y="100" class="text-small" text-anchor="middle">(PerfumeStoreContext)</text>
  
  <rect x="650" y="60" width="120" height="60" class="actor" rx="5"/>
  <text x="710" y="85" class="text-bold" text-anchor="middle">Authentication</text>
  <text x="710" y="100" class="text-small" text-anchor="middle">(Cookie Auth)</text>
  
  <!-- Lifelines -->
  <line x1="110" y1="120" x2="110" y2="750" class="lifeline"/>
  <line x1="310" y1="120" x2="310" y2="750" class="lifeline"/>
  <line x1="510" y1="120" x2="510" y2="750" class="lifeline"/>
  <line x1="710" y1="120" x2="710" y2="750" class="lifeline"/>
  
  <!-- Sequence -->
  <!-- Step 1: User requests login page -->
  <line x1="110" y1="150" x2="310" y2="150" class="message"/>
  <text x="210" y="145" class="text-small">GET /Auth/Login</text>
  
  <rect x="270" y="140" width="80" height="20" class="activation"/>
  
  <line x1="310" y1="160" x2="110" y2="160" class="message" stroke-dasharray="5,5"/>
  <text x="210" y="165" class="text-small">Hiển thị form đăng nhập</text>
  
  <!-- Step 2: User submits login form -->
  <line x1="110" y1="200" x2="310" y2="200" class="message"/>
  <text x="210" y="195" class="text-small">POST /Auth/Login</text>
  <text x="210" y="205" class="text-small">(email, password)</text>
  
  <rect x="270" y="190" width="80" height="20" class="activation"/>
  
  <!-- Step 3: Find customer by email -->
  <line x1="310" y1="230" x2="510" y2="230" class="message"/>
  <text x="410" y="225" class="text-small">Tìm Customer theo email</text>
  
  <rect x="470" y="220" width="80" height="20" class="activation"/>
  
  <line x1="510" y1="240" x2="310" y2="240" class="message" stroke-dasharray="5,5"/>
  <text x="410" y="245" class="text-small">Trả về Customer</text>
  
  <!-- Alt: Customer not found -->
  <rect x="40" y="270" width="1120" height="60" class="alt-box"/>
  <text x="50" y="290" class="text-bold">[Customer không tồn tại]</text>
  
  <line x1="310" y1="310" x2="110" y2="310" class="message" stroke-dasharray="5,5"/>
  <text x="210" y="305" class="text-small">Hiển thị lỗi: "Email hoặc mật khẩu</text>
  <text x="210" y="315" class="text-small">không đúng"</text>
  
  <!-- Alt: Customer found - Verify password -->
  <rect x="40" y="350" width="1120" height="380" class="alt-box"/>
  <text x="50" y="370" class="text-bold">[Customer tồn tại - Xác thực mật khẩu]</text>
  
  <!-- Step 4: Verify password -->
  <line x1="310" y1="400" x2="310" y2="420" class="self-message"/>
  <text x="320" y="410" class="text-small">BCrypt.Verify(password,</text>
  <text x="320" y="420" class="text-small">customer.PasswordHash)</text>
  
  <!-- Alt: Password incorrect -->
  <rect x="40" y="450" width="1120" height="60" class="alt-box"/>
  <text x="50" y="470" class="text-bold">[Mật khẩu không đúng]</text>
  
  <line x1="310" y1="490" x2="110" y2="490" class="message" stroke-dasharray="5,5"/>
  <text x="210" y="485" class="text-small">Hiển thị lỗi: "Email hoặc mật khẩu</text>
  <text x="210" y="495" class="text-small">không đúng"</text>
  
  <!-- Alt: Password correct - Create authentication -->
  <rect x="40" y="530" width="1120" height="200" class="alt-box"/>
  <text x="50" y="550" class="text-bold">[Mật khẩu đúng - Tạo authentication]</text>
  
  <!-- Step 5: Create claims -->
  <line x1="310" y1="580" x2="310" y2="600" class="self-message"/>
  <text x="320" y="590" class="text-small">Tạo Claims:</text>
  <text x="320" y="600" class="text-small">- NameIdentifier (CustomerId)</text>
  <text x="320" y="610" class="text-small">- Name</text>
  <text x="320" y="620" class="text-small">- Email</text>
  
  <!-- Step 6: Create ClaimsIdentity -->
  <line x1="310" y1="640" x2="310" y2="660" class="self-message"/>
  <text x="320" y="650" class="text-small">Tạo ClaimsIdentity</text>
  <text x="320" y="660" class="text-small">với CookieAuthenticationScheme</text>
  
  <!-- Step 7: Sign in -->
  <line x1="310" y1="680" x2="710" y2="680" class="message"/>
  <text x="510" y="675" class="text-small">SignInAsync</text>
  <text x="510" y="685" class="text-small">(ClaimsPrincipal, AuthProperties)</text>
  
  <rect x="670" y="670" width="80" height="20" class="activation"/>
  
  <line x1="710" y1="690" x2="310" y2="690" class="message" stroke-dasharray="5,5"/>
  <text x="510" y="695" class="text-small">Đã tạo cookie</text>
  
  <!-- Step 8: Redirect to home -->
  <line x1="310" y1="710" x2="110" y2="710" class="message" stroke-dasharray="5,5"/>
  <text x="210" y="705" class="text-small">RedirectToAction("Index", "Home")</text>
  
  <!-- End activations -->
  <rect x="270" y="140" width="80" height="20" fill="white" opacity="0"/>
  <rect x="270" y="190" width="80" height="520" fill="white" opacity="0"/>
  <rect x="470" y="220" width="80" height="20" fill="white" opacity="0"/>
  <rect x="670" y="670" width="80" height="20" fill="white" opacity="0"/>
</svg>


